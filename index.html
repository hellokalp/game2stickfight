<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Stickman Fight</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: radial-gradient(circle at center, #111 0%, #000 100%);
  }

  canvas {
    display: block;
    width: 100%;
    height: 100%;
    background: transparent;
  }

  /* Touch controls */
  .controls {
    position: fixed;
    left: 0;
    right: 0;
    display: none;
    z-index: 10;
    justify-content: space-around;
  }

  .controls.bottom { bottom: 15px; }
  .controls.top { top: 15px; }

  .btn-group {
    display: flex;
    gap: 8px;
  }

  .btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 2px solid #fff;
    color: white;
    font-size: 20px;
    text-align: center;
    line-height: 60px;
    user-select: none;
    box-shadow: 0 0 10px rgba(255,255,255,0.3);
  }

  @media (max-width: 768px) {
    .controls { display: flex; flex-wrap: wrap; }
  }
</style>
</head>
<body>
<canvas id="game"></canvas>

<!-- Player 1 controls (bottom) -->
<div class="controls bottom" id="bottomControls">
  <div class="btn-group">
    <div class="btn" id="aBtn">A</div>
    <div class="btn" id="dBtn">D</div>
    <div class="btn" id="wBtn">W</div>
    <div class="btn" id="sBtn">S</div>
  </div>
</div>

<!-- Player 2 controls (top) -->
<div class="controls top" id="topControls">
  <div class="btn-group">
    <div class="btn" id="leftBtn">←</div>
    <div class="btn" id="rightBtn">→</div>
    <div class="btn" id="upBtn">↑</div>
    <div class="btn" id="downBtn">↓</div>
  </div>
</div>

<audio id="punchSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_62e254a35f.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

const punchSound = document.getElementById("punchSound");

class Fighter {
  constructor(x, color, keys) {
    this.x = x;
    this.y = canvas.height / 2; // Start in center area
    this.width = 50;
    this.height = 100;
    this.color = color;
    this.dy = 0;
    this.speed = 6;
    this.keys = keys;
    this.onGround = false;
    this.hp = 100;
  }

  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);
    ctx.fillStyle = "white";
    ctx.fillRect(this.x + this.width/2 - 5, this.y + 20, 10, 5);
  }

  move(left, right, jump) {
    if (left) this.x -= this.speed;
    if (right) this.x += this.speed;
    if (jump && this.onGround) {
      this.dy = -15;
      this.onGround = false;
    }
    this.y += this.dy;
    this.dy += 0.8;
    if (this.y >= canvas.height - 150) {
      this.y = canvas.height - 150;
      this.dy = 0;
      this.onGround = true;
    }
    this.x = Math.max(0, Math.min(this.x, canvas.width - this.width));
  }

  attack(opponent) {
    if (
      this.x + this.width > opponent.x &&
      this.x < opponent.x + opponent.width &&
      this.y + this.height > opponent.y &&
      this.y < opponent.y + opponent.height
    ) {
      punchSound.currentTime = 0;
      punchSound.play();
      opponent.hp -= 1.2;
    }
  }

  showHP(xPos, yPos) {
    ctx.fillStyle = "red";
    ctx.fillRect(xPos, yPos, 200, 20);
    ctx.fillStyle = "lime";
    ctx.fillRect(xPos, yPos, (this.hp / 100) * 200, 20);
  }
}

const center = canvas.width / 2;
const player1 = new Fighter(center - 150, "cyan", {left: "a", right: "d", up: "w", attack: "s"});
const player2 = new Fighter(center + 100, "orange", {left: "ArrowLeft", right: "ArrowRight", up: "ArrowUp", attack: "ArrowDown"});
const keys = {};

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

/* --- Touch controls --- */
function bindButton(id, keyName) {
  const btn = document.getElementById(id);
  btn.addEventListener("touchstart", e => { e.preventDefault(); keys[keyName] = true; });
  btn.addEventListener("touchend", e => { e.preventDefault(); keys[keyName] = false; });
}
["aBtn","dBtn","wBtn","sBtn","leftBtn","rightBtn","upBtn","downBtn"].forEach((id,i)=>{
  const key = ["a","d","w","s","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"][i];
  bindButton(id,key);
});

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  player1.move(keys[player1.keys.left], keys[player1.keys.right], keys[player1.keys.up]);
  player2.move(keys[player2.keys.left], keys[player2.keys.right], keys[player2.keys.up]);

  if (keys[player1.keys.attack]) player1.attack(player2);
  if (keys[player2.keys.attack]) player2.attack(player1);

  player1.draw();
  player2.draw();

  // HP bars now moved away from buttons
  player1.showHP(20, canvas.height - 90); // above bottom buttons
  player2.showHP(canvas.width - 220, 60); // below top buttons

  if (player1.hp <= 0 || player2.hp <= 0) {
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.fillText(`${player1.hp <= 0 ? "Player 2" : "Player 1"} Wins!`, canvas.width/2 - 150, canvas.height/2);
    return;
  }

  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
