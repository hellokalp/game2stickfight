<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stick Fight ‚Äî Dark Mode</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: radial-gradient(circle at center, #000, #050505);
      overflow: hidden;
      color: #0f0;
      font-family: monospace;
      text-align: center;
      height: 100vh;
    }
    canvas {
      background: linear-gradient(180deg, #000 0%, #111 100%);
      display: block;
      margin: 0 auto;
    }
    .controls {
      margin-top: 10px;
    }
    button {
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      border-radius: 10px;
      padding: 8px 16px;
      font-size: 16px;
      margin: 5px;
      transition: 0.2s;
    }
    button:hover {
      background: #0f0;
      color: #000;
    }
    #gameCode {
      font-size: 20px;
      color: #0f0;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>üïπÔ∏è Stick Fight ‚Äî Dark Theme</h2>
  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <div class="controls">
    <button id="createGame">Create Game</button>
    <button id="joinGame">Join Game</button>
    <input type="text" id="joinCode" placeholder="Enter 4-digit code" />
  </div>

  <div id="gameCode"></div>

  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let peer, conn, playerId, playerColor;

    const player1 = { x: 150, y: 320, color: "#0f0", left: false, right: false, punch: false };
    const player2 = { x: 650, y: 320, color: "#f00", left: false, right: false, punch: false };

    function drawPlayer(p) {
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x - 5, p.y - 50, 10, 50);
      ctx.beginPath();
      ctx.arc(p.x, p.y - 60, 8, 0, Math.PI * 2);
      ctx.fill();
      if (p.punch) {
        ctx.fillRect(p.x + (p.color === "#0f0" ? 10 : -20), p.y - 40, 10, 5);
      }
    }

    function update() {
      if (player1.left) player1.x -= 3;
      if (player1.right) player1.x += 3;
      if (player2.left) player2.x -= 3;
      if (player2.right) player2.x += 3;
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer(player1);
      drawPlayer(player2);
    }

    function loop() {
      update();
      render();
      requestAnimationFrame(loop);
    }
    loop();

    // Movement keys
    document.addEventListener("keydown", e => {
      if (playerId === "host") {
        if (e.key === "a") player1.left = true;
        if (e.key === "d") player1.right = true;
        if (e.key === "w") player1.punch = true;
      } else {
        if (e.key === "j") player2.left = true;
        if (e.key === "l") player2.right = true;
        if (e.key === "i") player2.punch = true;
      }
    });

    document.addEventListener("keyup", e => {
      if (playerId === "host") {
        if (e.key === "a") player1.left = false;
        if (e.key === "d") player1.right = false;
        if (e.key === "w") player1.punch = false;
      } else {
        if (e.key === "j") player2.left = false;
        if (e.key === "l") player2.right = false;
        if (e.key === "i") player2.punch = false;
      }
    });

    // PeerJS setup
    document.getElementById("createGame").onclick = () => {
      peer = new Peer({
        host: "0.peerjs.com",
        port: 443,
        secure: true,
        debug: 2
      });

      peer.on("open", id => {
        playerId = "host";
        const code = id.slice(-4).toUpperCase();
        document.getElementById("gameCode").innerText = "Your Code: " + code;
      });

      peer.on("connection", c => {
        conn = c;
        conn.on("data", d => {
          Object.assign(player2, d);
        });
        alert("Player joined!");
      });
    };

    document.getElementById("joinGame").onclick = () => {
      const code = document.getElementById("joinCode").value.trim();
      if (!code) return alert("Enter code");
      peer = new Peer({
        host: "0.peerjs.com",
        port: 443,
        secure: true,
        debug: 2
      });

      peer.on("open", id => {
        playerId = "join";
        conn = peer.connect(id.replace(/.{4}$/, code));
        conn.on("open", () => {
          alert("Connected to host!");
        });
      });
    };

    setInterval(() => {
      if (conn && conn.open) {
        if (playerId === "host") conn.send(player1);
        else conn.send(player2);
      }
    }, 50);
  </script>
</body>
</html>
