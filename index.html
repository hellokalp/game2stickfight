<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Stickman Fight</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at center, #111 0%, #000 100%);
    overflow: hidden;
    height: 100vh;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: transparent;
  }

  /* Mobile controls */
  .controls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: none;
    justify-content: space-around;
    z-index: 10;
  }

  .btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 2px solid #fff;
    color: white;
    font-size: 20px;
    text-align: center;
    line-height: 60px;
    user-select: none;
  }

  @media (max-width: 768px) {
    .controls { display: flex; }
  }
</style>
</head>
<body>
<canvas id="game"></canvas>

<div class="controls" id="controls">
  <div>
    <div class="btn" id="left1">←</div>
    <div class="btn" id="right1">→</div>
    <div class="btn" id="jump1">↑</div>
  </div>
  <div>
    <div class="btn" id="left2">A</div>
    <div class="btn" id="right2">D</div>
    <div class="btn" id="jump2">W</div>
  </div>
</div>

<audio id="punchSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_62e254a35f.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const punchSound = document.getElementById("punchSound");

class Fighter {
  constructor(x, color, keys) {
    this.x = x;
    this.y = canvas.height - 150;
    this.width = 50;
    this.height = 100;
    this.color = color;
    this.dy = 0;
    this.speed = 6;
    this.keys = keys;
    this.onGround = true;
    this.hp = 100;
  }

  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);
    // face line
    ctx.fillStyle = "white";
    ctx.fillRect(this.x + this.width/2 - 5, this.y + 20, 10, 5);
  }

  move(left, right, jump) {
    if (left) this.x -= this.speed;
    if (right) this.x += this.speed;
    if (jump && this.onGround) {
      this.dy = -15;
      this.onGround = false;
    }
    this.y += this.dy;
    this.dy += 0.8;
    if (this.y >= canvas.height - 150) {
      this.y = canvas.height - 150;
      this.dy = 0;
      this.onGround = true;
    }
  }

  attack(opponent) {
    if (
      this.x + this.width > opponent.x &&
      this.x < opponent.x + opponent.width &&
      this.y + this.height > opponent.y &&
      this.y < opponent.y + opponent.height
    ) {
      punchSound.currentTime = 0;
      punchSound.play();
      opponent.hp -= 1.5;
    }
  }

  showHP(xPos) {
    ctx.fillStyle = "red";
    ctx.fillRect(xPos, 30, 200, 20);
    ctx.fillStyle = "lime";
    ctx.fillRect(xPos, 30, (this.hp / 100) * 200, 20);
  }
}

const player1 = new Fighter(200, "cyan", {left: "a", right: "d", up: "w", attack: "s"});
const player2 = new Fighter(canvas.width - 250, "orange", {left: "ArrowLeft", right: "ArrowRight", up: "ArrowUp", attack: "ArrowDown"});

const keys = {};

window.addEventListener("keydown", (e) => (keys[e.key] = true));
window.addEventListener("keyup", (e) => (keys[e.key] = false));

// Mobile controls
document.getElementById("left1").addEventListener("touchstart", () => keys["ArrowLeft"] = true);
document.getElementById("right1").addEventListener("touchstart", () => keys["ArrowRight"] = true);
document.getElementById("jump1").addEventListener("touchstart", () => keys["ArrowUp"] = true);
document.getElementById("left2").addEventListener("touchstart", () => keys["a"] = true);
document.getElementById("right2").addEventListener("touchstart", () => keys["d"] = true);
document.getElementById("jump2").addEventListener("touchstart", () => keys["w"] = true);

document.querySelectorAll(".btn").forEach(btn =>
  btn.addEventListener("touchend", () => keys[btn.innerText.toLowerCase()] = false)
);

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  player1.move(keys[player1.keys.left], keys[player1.keys.right], keys[player1.keys.up]);
  player2.move(keys[player2.keys.left], keys[player2.keys.right], keys[player2.keys.up]);

  if (keys[player1.keys.attack]) player1.attack(player2);
  if (keys[player2.keys.attack]) player2.attack(player1);

  player1.draw();
  player2.draw();
  player1.showHP(50);
  player2.showHP(canvas.width - 250);

  if (player1.hp <= 0 || player2.hp <= 0) {
    ctx.fillStyle = "white";
    ctx.font = "50px Arial";
    ctx.fillText(`${player1.hp <= 0 ? "Player 2" : "Player 1"} Wins!`, canvas.width / 2 - 150, canvas.height / 2);
    return;
  }

  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
