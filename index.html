<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stickman Fight</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at center, #111 0%, #000 100%);
    overflow: hidden;
    height: 100vh;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: transparent;
  }

  /* Mobile Controls Layout */
  .controls {
    position: fixed;
    width: 100%;
    display: none;
    z-index: 10;
  }

  .controls.bottom {
    bottom: 10px;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
  }

  .controls.top {
    top: 10px;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
  }

  .btn-group {
    display: flex;
    gap: 10px;
  }

  .btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 2px solid #fff;
    color: white;
    font-size: 20px;
    text-align: center;
    line-height: 60px;
    user-select: none;
    box-shadow: 0 0 10px rgba(255,255,255,0.2);
  }

  @media (max-width: 768px) {
    .controls { display: flex; }
  }
</style>
</head>
<body>
<canvas id="game"></canvas>

<!-- Player 1 Controls (Bottom Left) -->
<div class="controls bottom" id="bottomControls">
  <div class="btn-group" id="p1">
    <div class="btn" id="aBtn">A</div>
    <div class="btn" id="dBtn">D</div>
    <div class="btn" id="wBtn">W</div>
    <div class="btn" id="sBtn">S</div>
  </div>
  <div class="btn-group" id="p2">
    <div class="btn" id="leftBtn">←</div>
    <div class="btn" id="rightBtn">→</div>
    <div class="btn" id="upBtn">↑</div>
    <div class="btn" id="downBtn">↓</div>
  </div>
</div>

<audio id="punchSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_62e254a35f.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const punchSound = document.getElementById("punchSound");

class Fighter {
  constructor(x, color, keys) {
    this.x = x;
    this.y = canvas.height - 150;
    this.width = 50;
    this.height = 100;
    this.color = color;
    this.dy = 0;
    this.speed = 6;
    this.keys = keys;
    this.onGround = true;
    this.hp = 100;
  }

  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);
    ctx.fillStyle = "white";
    ctx.fillRect(this.x + this.width/2 - 5, this.y + 20, 10, 5);
  }

  move(left, right, jump) {
    if (left) this.x -= this.speed;
    if (right) this.x += this.speed;
    if (jump && this.onGround) {
      this.dy = -15;
      this.onGround = false;
    }
    this.y += this.dy;
    this.dy += 0.8;
    if (this.y >= canvas.height - 150) {
      this.y = canvas.height - 150;
      this.dy = 0;
      this.onGround = true;
    }
  }

  attack(opponent) {
    if (
      this.x + this.width > opponent.x &&
      this.x < opponent.x + opponent.width &&
      this.y + this.height > opponent.y &&
      this.y < opponent.y + opponent.height
    ) {
      punchSound.currentTime = 0;
      punchSound.play();
      opponent.hp -= 1.5;
    }
  }

  showHP(xPos) {
    ctx.fillStyle = "red";
    ctx.fillRect(xPos, 30, 200, 20);
    ctx.fillStyle = "lime";
    ctx.fillRect(xPos, 30, (this.hp / 100) * 200, 20);
  }
}

const player1 = new Fighter(200, "cyan", {left: "a", right: "d", up: "w", attack: "s"});
const player2 = new Fighter(canvas.width - 250, "orange", {left: "ArrowLeft", right: "ArrowRight", up: "ArrowUp", attack: "ArrowDown"});
const keys = {};

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

/* --- Mobile Buttons --- */
function bindButton(id, keyName) {
  const btn = document.getElementById(id);
  btn.addEventListener("touchstart", () => keys[keyName] = true);
  btn.addEventListener("touchend", () => keys[keyName] = false);
}
bindButton("aBtn", "a");
bindButton("dBtn", "d");
bindButton("wBtn", "w");
bindButton("sBtn", "s");
bindButton("leftBtn", "ArrowLeft");
bindButton("rightBtn", "ArrowRight");
bindButton("upBtn", "ArrowUp");
bindButton("downBtn", "ArrowDown");

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  player1.move(keys[player1.keys.left], keys[player1.keys.right], keys[player1.keys.up]);
  player2.move(keys[player2.keys.left], keys[player2.keys.right], keys[player2.keys.up]);

  if (keys[player1.keys.attack]) player1.attack(player2);
  if (keys[player2.keys.attack]) player2.attack(player1);

  player1.draw();
  player2.draw();
  player1.showHP(50);
  player2.showHP(canvas.width - 250);

  if (player1.hp <= 0 || player2.hp <= 0) {
    ctx.fillStyle = "white";
    ctx.font = "50px Arial";
    ctx.fillText(`${player1.hp <= 0 ? "Player 2" : "Player 1"} Wins!`, canvas.width / 2 - 150, canvas.height / 2);
    return;
  }

  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
