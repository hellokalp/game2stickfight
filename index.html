<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Stick Fight ‚Äî Dark Theme</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: radial-gradient(circle at center, #000, #020202);
      color: #0f0;
      font-family: monospace;
      overflow: hidden;
      text-align: center;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: linear-gradient(180deg, #000 0%, #111 100%);
    }
    .ui {
      margin-top: 10px;
    }
    button {
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      border-radius: 10px;
      padding: 8px 16px;
      font-size: 16px;
      margin: 5px;
    }
    button:hover { background: #0f0; color: #000; }
    #controls {
      position: fixed;
      bottom: 10px;
      left: 0; right: 0;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      z-index: 10;
    }
    .btn {
      background: #111;
      border: 1px solid #0f0;
      border-radius: 50%;
      color: #0f0;
      width: 60px; height: 60px;
      font-size: 22px;
      display: flex; justify-content: center; align-items: center;
      margin: 5px;
    }
    #gameCode { margin-top: 10px; font-size: 18px; color: #0f0; }
  </style>
</head>
<body>
  <h2>‚öîÔ∏è Stick Fight ‚Äî Dark Theme</h2>
  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <div class="ui">
    <button id="createGame">Create Game</button>
    <button id="joinGame">Join Game</button>
    <input type="text" id="joinCode" placeholder="Enter 4-digit code" />
  </div>

  <div id="gameCode"></div>

  <!-- On-screen buttons -->
  <div id="controls" style="display:none;">
    <div>
      <button class="btn" id="leftBtn">‚Üê</button>
      <button class="btn" id="rightBtn">‚Üí</button>
    </div>
    <div>
      <button class="btn" id="punchBtn">üëä</button>
    </div>
  </div>

  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let peer, conn, role;

    const player1 = { x: 150, y: 320, color: "#0f0", left: false, right: false, punch: false };
    const player2 = { x: 650, y: 320, color: "#f00", left: false, right: false, punch: false };

    function drawPlayer(p) {
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x - 5, p.y - 50, 10, 50);
      ctx.beginPath();
      ctx.arc(p.x, p.y - 60, 8, 0, Math.PI * 2);
      ctx.fill();
      if (p.punch) {
        ctx.fillRect(p.x + (p.color === "#0f0" ? 10 : -20), p.y - 40, 10, 5);
      }
    }

    function update() {
      if (player1.left) player1.x -= 3;
      if (player1.right) player1.x += 3;
      if (player2.left) player2.x -= 3;
      if (player2.right) player2.x += 3;
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer(player1);
      drawPlayer(player2);
    }

    function loop() {
      update();
      render();
      requestAnimationFrame(loop);
    }
    loop();

    // ======== PEERJS CONNECTION ======== //
    document.getElementById("createGame").onclick = () => {
      peer = new Peer({ host: "0.peerjs.com", port: 443, secure: true });
      role = "host";
      document.getElementById("controls").style.display = "flex";

      peer.on("open", id => {
        const code = id.slice(-4).toUpperCase();
        document.getElementById("gameCode").innerText = "Your Code: " + code;
      });

      peer.on("connection", c => {
        conn = c;
        conn.on("data", data => Object.assign(player2, data));
        alert("Player joined!");
      });
    };

    document.getElementById("joinGame").onclick = () => {
      const code = document.getElementById("joinCode").value.trim();
      if (!code) return alert("Enter 4-digit code");
      peer = new Peer({ host: "0.peerjs.com", port: 443, secure: true });
      role = "join";
      document.getElementById("controls").style.display = "flex";

      peer.on("open", id => {
        conn = peer.connect(id.replace(/.{4}$/, code));
        conn.on("open", () => alert("Connected to host!"));
        conn.on("data", data => Object.assign(player1, data));
      });
    };

    setInterval(() => {
      if (conn && conn.open) {
        if (role === "host") conn.send(player1);
        else conn.send(player2);
      }
    }, 50);

    // ======== MOBILE BUTTONS ======== //
    const btns = {
      left: document.getElementById("leftBtn"),
      right: document.getElementById("rightBtn"),
      punch: document.getElementById("punchBtn")
    };

    function handleButton(btn, prop) {
      btn.addEventListener("touchstart", e => {
        e.preventDefault();
        if (role === "host") player1[prop] = true;
        else player2[prop] = true;
      });
      btn.addEventListener("touchend", e => {
        e.preventDefault();
        if (role === "host") player1[prop] = false;
        else player2[prop] = false;
      });
    }

    handleButton(btns.left, "left");
    handleButton(btns.right, "right");
    handleButton(btns.punch, "punch");

    // ======== AUTO ROTATE TO LANDSCAPE ======== //
    window.addEventListener("load", () => {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("landscape").catch(() => {});
      }
    });
  </script>
</body>
</html>
